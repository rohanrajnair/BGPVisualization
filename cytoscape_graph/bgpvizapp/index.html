<!DOCTYPE html>

<html>
  <head>
    <title>BGP Graph Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.1/cytoscape.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="/popper.js"></script>
    <link rel="stylesheet" href="/css/main.css"> 
    <script src="https://unpkg.com/tippy.js@6"></script>
    
  </head>
  <script>
    var ws = new WebSocket(
      "wss://ris-live.ripe.net/v1/ws/" //?client=js-example-1"
    );
    var params = {
      moreSpecific: true,
      host: "rrc21",
      socketOptions: {
        includeRaw: true,
      },
    };
    var msg_counter = 0;
    ws.onmessage = function (event) {
      var message = JSON.parse(event.data);
      var data = message.data;
      // console.log("type:" + data.type);
      // console.log("withdrawals:" + data.withdrawals);
      if (data.path) {
        addNode(cy, data);
      }
      if (msg_counter % 500 == 0) {
        var layout = cy.elements().layout({ name: "cose", animate: true });
        layout.run();
      }
      msg_counter++;
      document.getElementById(
        "msg_count"
      ).innerHTML = `Message count: ${msg_counter}`;
      // console.log(message.type, message.data);
    };
    ws.onopen = function () {
      ws.send(
        JSON.stringify({
          type: "ris_subscribe",
          data: params,
        })
      );
    };
  </script>
  <style>
    #cy {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0px;
      left: 0px;
    }
  </style>

  <body>
    <div id="cy"></div>
    <script src="/js/script.js"></script>
    <h1>BGP Data Visualization</h1>
    <h2 id="msg_count"></h2>
  </body>
</html>
